# lottery dapp 开发文档

# 后端contract

## lottery

### 购买

确定购买条件

- 是否在下注时间内

- 余额是否足够 下注+gas

- 号码正确性

处理付款

- 金额验证
- 一定是收到钱再发彩票

生成彩票

- 生成唯一识别码

记录交易

- 记录购买者，彩票编号，购买时间

- 存入当期彩票数组

更新状态

- 总销售额
- 剩余数量？

安全性

- 重入攻击
- 异常处理

### 随机数生成

- 块hash。安全？最近256个被操控
- 第三方生成

 

### 开奖

- 开放透明
- 随机性--hash/第三方
- 确定性----某一期中奖号码一定唯一，开奖函数被调很多次也只能有一个结果
- 防止重开攻击--同上
- 公开彩票编号

 

### 奖金分配

- 按照公平规则--确定性
- 正确执行，每个中奖者都收到了奖金
- 防止重放攻击，多次调用分配函数也不会有问题
- 整数溢出等数值错误
- 异常情况 1.奖金不够发 2.某个奖金没有发放成功

 

### 安全

- 函数权限管理
- 重放攻击，函数在某些条件下只执行一次
- 数字溢出问题
- 函数调用失败的异常处理
- 延时付款体系，防止攻击
- 升级或者暂停 



# 前端